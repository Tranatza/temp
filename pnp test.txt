# Parameters
$siteUrl = "<site-url>"
$libraryName = "<library-name>"
$folderRelativeUrl = "<folder-relative-url>"
$fileName = "<file-name>"
$localFilePath = "<local-file-path>"
$note = "<note>"
$versionNumber = "<version-number>"

# Connect to SharePoint Online
Connect-PnPOnline -Url $siteUrl -UseWebLogin

# Get the SharePoint folder
$folder = Get-PnPFolder -Url $folderRelativeUrl -Library $libraryName

# Get the file in the folder
$fileUrl = $folderRelativeUrl + "/" + $fileName
$file = Get-PnPFile -Url $fileUrl -AsListItem

# Upload the updated file
$targetFilePath = $folderRelativeUrl + "/" + $fileName
Add-PnPFile -Path $localFilePath -Folder $folder -FileName $fileName -Overwrite

# Check in the file
$file = Get-PnPFile -Url $fileUrl -AsListItem
$file.CheckIn($note, [Microsoft.SharePoint.Client.CheckinType]::MajorCheckIn)
$file.Context.ExecuteQuery()

# Set custom semantic version number
if ($versionNumber) {
    $file["SemanticVersion"] = $versionNumber
    $file.Update()
    $file.Context.ExecuteQuery()
    Write-Host "Updated file version to: $versionNumber"
}

Write-Host "Updated file uploaded successfully."
